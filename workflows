{
  "name": "MiniProject-Main chat bot auto reply email for LRTJ1B-ERSA",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {
          "readStatus": "unread"
        }
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        64,
        160
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Gmail Trigger",
      "credentials": {
        "gmailOAuth2": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "LRTJ1B-ERSA"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "simple": false,
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        960,
        144
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Get a message",
      "webhookId": "xxxxxxxxxxxxxxxxxx",
      "credentials": {
        "gmailOAuth2": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "LRTJ1B-ERSA"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"sender_status\": \"PMC | KSO | 3PV | JAKPRO | UNKNOWN\",\n  \"need_sa\": true,\n  \"action\": \"RESPOND | IGNORE\",\n  \"reason\": \"string\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        592,
        416
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        256,
        416
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "gpt-4-mini1",
      "credentials": {
        "openAiApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "Setiawan"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=From: {{ $json.From }}\nSubject: {{ $json.Subject }}\nEmail Snippet: {{ $json.snippet }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "You are an AI specialized in analyzing emails.\n\nYou will receive:\n1. Email subject\n2. Email snippet\n3. A configuration table containing sender rules and ignore rules\n\nInstructions:\n- always use General_Config\n- Identify the sender by matching the subject or snippet against sender rules.\n- If multiple rules match, choose the highest priority.\n- If ignore keywords are detected, classify the email as IGNORE.\n- Determine whether the email requires SA Assistant based on configuration.\n\nOutput MUST follow structured format:\n- sender_status\n- need_sa (true/false)\n- reason\n"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        352,
        160
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Need SA Assistant?"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "ergsdocs",
          "mode": "list",
          "cachedResultName": "ergsdocs"
        },
        "embeddingBatchSize": 800000,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        400,
        912
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Supabase Vector Store",
      "notesInFlow": false,
      "credentials": {
        "supabaseApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "LRTJ1B"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        288,
        1168
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "Setiawan"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "loader": "pdfLoader",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        608,
        1152
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "use this tool to get any information about document of VOLUME 3 – The Employer’s Requirement – GENERAL SPECIFICATION Clause 20 & 21",
        "tableName": {
          "__rl": true,
          "value": "ergsdocs",
          "mode": "list",
          "cachedResultName": "ergsdocs"
        },
        "topK": 10,
        "options": {
          "queryName": "match_ergsdocs"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1712,
        304
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "LRTJ1B"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1728,
        448
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "Setiawan"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "allowFileUploads": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        64,
        912
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "When chat message received",
      "webhookId": "xxxxxxxxxxxxxxxxxx"
    },
    {
      "parameters": {
        "needsFallback": true,
        "options": {
          "systemMessage": "Send output AI to email"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1456,
        144
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.chatInput }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1584,
        416
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.email_id }}",
        "subject": "={{ $('Gmail Trigger').item.json.Subject }}",
        "message": "=Question : {{ $json.Question }}\nAnswer : \n{{ $json.Answer }}",
        "options": {
          "appendAttribution": false,
          "ccList": "pray4bms@gmail.com"
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        2064,
        144
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Send a message",
      "webhookId": "xxxxxxxxxxxxxxxxxx",
      "credentials": {
        "gmailOAuth2": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "LRTJ1B-ERSA"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "input_type",
              "value": "email",
              "type": "string"
            },
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "chatInput",
              "value": "={{ $json.html }}",
              "type": "string"
            },
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "email_id",
              "value": "={{ $json.from.value[0].address }}",
              "type": "string"
            },
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "subject",
              "value": "={{ $json.subject }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1152,
        144
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Set Context"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "leftValue": "={{ $json.output.need_sa }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        688,
        160
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "IF Need SA Assistant"
    },
    {
      "parameters": {
        "content": "## Pemeriksaan Email Masuk\n**Apakah email yang masuk membutuhkan SA Assistant atau tidak?**\n*Jika membutuhkan SA Assistant, maka pesan email diteruskan dengan transformasi data*\n*Jika tidak membutuhkan SA Assistant, maka pesan email tidak diteruskan (selesai)*",
        "height": 592,
        "width": 1072,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        240,
        0
      ],
      "typeVersion": 1,
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Cek email masuk\n*ke dalam Inbox Email (To) yang sudah ditentukan*",
        "height": 592
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Pemeriksaan Pesan Email ke dalam database Supabase\n*Membaca isi email untuk diperiksa oleh AI Agent ke dalam database Supabase yang berisi pengetahuan tentang dokumen ER System Assurance (SA). Jika isi email ditemukan atau tidak ditemukan dalam database Supabase, respon akan dikirimkan kembali ke alamat email pengirim (From)*",
        "height": 592,
        "width": 672,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1312,
        0
      ],
      "typeVersion": 1,
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Kirim respon AI Agent ke email Pengirim\n",
        "height": 592,
        "width": 304,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1984,
        0
      ],
      "typeVersion": 1,
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1344,
        336
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "Setiawan"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -176,
        688
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Telegram Trigger",
      "webhookId": "xxxxxxxxxxxxxxxxxx",
      "credentials": {
        "telegramApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "bot testing n8n"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "input_type",
              "value": "AI Input",
              "type": "string"
            },
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "Question",
              "value": "={{ $('Set Context').item.json.chatInput }}",
              "type": "string"
            },
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "Answer",
              "value": "={{ $json.output }}",
              "type": "string"
            },
            {
              "id": "xxxxxxxxxxxxxxxxxx",
              "name": "email_id",
              "value": "={{ $('Get a message').item.json.from.value[0].address }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1840,
        144
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Message Format"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1440,
        464
      ],
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "xxxxxxxxxxxxxxxxxx",
          "name": "Setiawan"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Need SA Assistant?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a message": {
      "main": [
        [
          {
            "node": "Set Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Need SA Assistant?",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "gpt-4-mini1": {
      "ai_languageModel": [
        [
          {
            "node": "Need SA Assistant?",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Need SA Assistant?": {
      "main": [
        [
          {
            "node": "IF Need SA Assistant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Message Format",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Set Context": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Need SA Assistant": {
      "main": [
        [
          {
            "node": "Get a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Message Format": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "timezone": "Asia/Jakarta",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "xxxxxxxxxxxxxxxxxx"
  },
  "versionId": "899d0b6b-389c-497a-957d-f2ee08c007bb",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "xxxxxxxxxxxxxxxxxx"
  },
  "id": "SN5HKgmo7sNZLuEI",
  "tags": [
    {
      "updatedAt": "2025-12-12T01:30:42.029Z",
      "createdAt": "2025-12-12T01:30:42.029Z",
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Main_Workflow"
    },
    {
      "updatedAt": "2025-12-12T01:30:42.027Z",
      "createdAt": "2025-12-12T01:30:42.027Z",
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Chatbot"
    },
    {
      "updatedAt": "2025-12-12T01:30:42.035Z",
      "createdAt": "2025-12-12T01:30:42.035Z",
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "CRM_CS"
    },
    {
      "updatedAt": "2025-12-12T01:30:42.031Z",
      "createdAt": "2025-12-12T01:30:42.031Z",
      "id": "xxxxxxxxxxxxxxxxxx",
      "name": "Operational"
    }
  ]
}
